<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Gestor de gastos</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/icono.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icono.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <img src="{{ url_for('static', filename='images/icono.png') }}" alt="Logo Gestor" style="width:100%;height:100%;object-fit:cover;border-radius:10px">
      </div>
      <div>
        <div style="font-weight:800">Gestor de gastos</div>
        <div style="font-size:13px;color:var(--muted)">Tus gastos personales</div>
      </div>
    </div>
    <div class="user-actions">
      <div class="muted">Conectado: <strong>{{ user }}</strong></div>
      <a class="link" href="{{ url_for('logout') }}">Cerrar sesión</a>
    </div>
  </header>

  <main class="container">
    <div class="grid" style="display:grid;grid-template-columns:1fr 360px;gap:20px;align-items:start">
      <section>
        <div class="card" aria-labelledby="add-heading" style="margin-bottom:18px">
          <h2 id="add-heading" style="margin:0 0 8px">Añadir gasto</h2>
          <p class="muted" style="margin:0 0 12px">Anota tus gastos para llevar control.</p>
          <form class="add-form" method="post" action="{{ url_for('index') }}">
            <div style="display:grid;grid-template-columns:1fr 140px;gap:10px">
              <div>
                <label for="descripcion">Descripción</label>
                <input id="descripcion" name="descripcion" type="text" required>
              </div>
              <div>
                <label for="monto">Monto (€)</label>
                <input id="monto" name="monto" type="text" inputmode="decimal" required placeholder="0.00">
              </div>
            </div>
            <div style="margin-top:12px;display:flex;gap:10px;justify-content:flex-end">
              <button class="btn-primary" type="submit">Agregar gasto</button>
            </div>
          </form>
        </div>

        <div class="card">
          <h3 style="margin:0 0 12px">Mis gastos</h3>

          {% if gastos %}
          <table role="table" aria-label="Lista de gastos">
            <thead>
              <tr><th>Descripción</th><th>Monto</th><th>Fecha</th><th>Acciones</th></tr>
            </thead>
            <tbody>
              {% for g in gastos %}
              <tr>
                <td style="max-width:320px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">{{ g.descripcion }}</td>
                <td>{{ "%.2f"|format(g.monto) }} €</td>
                <td>{{ g.fecha }}</td>
                <td class="actions">
                  <a href="{{ url_for('modificar', id=g.id) }}" class="muted">Editar</a>
                  <form method="post" action="{{ url_for('eliminar', id=g.id) }}" style="display:inline" onsubmit="return confirm('¿Eliminar gasto?');">
                    <button type="submit" class="btn-danger">Eliminar</button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>

          <div class="list-card" aria-hidden="false">
            {% for g in gastos %}
            <div class="list-item">
              <div class="list-row">
                <div>
                  <div style="font-weight:700">{{ g.descripcion }}</div>
                  <div class="meta">{{ g.fecha }}</div>
                </div>
                <div style="text-align:right">
                  <div style="font-weight:800">{{ "%.2f"|format(g.monto) }} €</div>
                  <div style="margin-top:8px">
                    <a class="muted" href="{{ url_for('modificar', id=g.id) }}" style="margin-right:8px">Editar</a>
                    <form method="post" action="{{ url_for('eliminar', id=g.id) }}" style="display:inline" onsubmit="return confirm('¿Eliminar gasto?');">
                      <button type="button" onclick="this.closest('form').submit()" style="background:none;border:none;color:var(--danger);font-weight:700;cursor:pointer">Eliminar</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>

          <div class="total">Total: {{ "%.2f"|format(total) }} €</div>

          {% else %}
            <p class="muted">Aún no tienes gastos. Añade el primero arriba.</p>
          {% endif %}
        </div>
      </section>

      <aside>
        <div class="card" style="position:sticky;top:20px">
          <h4 style="margin:0 0 8px">Resumen</h4>
          <div style="display:flex;flex-direction:column;gap:8px">
            <div style="display:flex;justify-content:space-between"><span class="muted">Gastos</span><strong>{{ gastos|length }}</strong></div>
            <div style="display:flex;justify-content:space-between"><span class="muted">Total</span><strong>{{ "%.2f"|format(total) }} €</strong></div>
          </div>
        </div>

        <div style="height:12px"></div>
        
         <div class="card">
          <a href="{{ url_for('estadisticas') }}" style="display:block;text-align:center;padding:12px;background:var(--accent);color:#fff;border-radius:8px;text-decoration:none;font-weight:700;cursor:pointer">
            Ver estadísticas
          </a>
        </div>
      </aside>
    </div>
  </main>

  <footer>Gestor de gastos</footer>
</body>
</html>
